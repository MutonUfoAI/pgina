<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--

	zenlike1.0 by nodethirtythree design
	http://www.nodethirtythree.com

-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>pGina fork</title>
<meta name="keywords" content="" />
<meta name="description" content="" />

<link rel="stylesheet" type="text/css" href="https://mutonufoai.github.io/pgina/default_doc.css" />

</head>
<body>

<div id="outer">

	<div id="header">
		<div id="headercontent">
			<h1>pGina fork</h1>
			<h2>Open Source Windows Authentication</h2>
		</div>
		<div id="logo"><a href="https://mutonufoai.github.io/pgina/index.html"><img src="https://mutonufoai.github.io/pgina/images/pginalogo.png" /></a></div>
	</div>

	
	<div id="menu">
		<!-- HINT: Set the class of any menu link below to "active" to make it appear active -->
		<ul>
			<li><a href="https://mutonufoai.github.io/pgina/index.html">Home</a></li>
			<li><a href="https://mutonufoai.github.io/pgina/download.html">Download</a></li>
      <li><a href="https://mutonufoai.github.io/pgina/support.html">Support</a></li>
      <li><a href="https://mutonufoai.github.io/pgina/documentation.html" class="active">Documentation</a></li>
      <li><a href="https://mutonufoai.github.io/pgina/develop.html">Develop</a></li>
      <li><a href="https://mutonufoai.github.io/pgina/faq.html">FAQ</a></li>
      <li><a href="https://mutonufoai.github.io/pgina/thanks.html">Thanks</a></li>
		</ul>
	</div>

	<div id="menubottom"></div>

	<div id="content">
	    
	    
		
			
<h1 id="pgina_users_guide">pGina User’s Guide</h1>

<ul>
<li><a href="#installation">Installation</a></li>

<li><a href="#how_pgina_works">How pGina Works</a></li>

<li><a href="#configuration">Configuration</a></li>

<li><a href="#ordering_plugins">Ordering Plugins</a></li>

<li><a href="#credential_provider_filter">Credential Provider Filter</a></li>

<li><a href="#logging">Logging</a></li>

<li><a href="#remember">Remember</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>pGina is packaged in a standard Windows installer, so installation is as easy as downloading and running the installer. After initial installation, pGina will be configured with the “LocalMachine” plugin enabled for the authentication and gateway stages (see below). This means that you will be able to use pGina out-of-the-box to log into the machine using existing local accounts, and if necessary, the LocalMachine plugin will create accounts for authenticated users.</p>

<p>In addition to the “LocalMachine” plugin, a standard set of additional plugins is provided and made available, but none of them are initally enabled.</p>

<h3 id="verify_install">Verify Install</h3>

<p>After installation, start the pGina configuration application. Verify that the pGina service is running and that the Credential Provider/GINA is installed and enabled.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/components_green_screen.png" alt="pgina Components Enabled" /></p>

<p>pGina will not function properly unless these components are working. More information about the Credential Provider and pGina service is provied in the next section.</p>

<h2 id="how_pgina_works">How pGina Works</h2>

<p>pGina is a replacement for the default Windows Credential Provider (or CP). Through plugins, pGina allows you to configure many aspects of the login process from authentication and authorization through to logging and terminal events.</p>

<p><em>Note that the Credential Provider framework is supported in Windows 7/Vista and higher. Prior versions of Windows used a framework called GINA. For much of this guide, we’ll simply refer to it as a Credential Provider or CP.</em></p>

<p>The diagram below represents a high-level picture of a typical logon process.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pGina-logon-overview.png" alt="pGina logon diagram" /></p>

<p><span class='greenbg'>To distinguish between pGina and a nomal windows user accounts, every pGina user is marked with a user comment of<i>&quot;pGina created&quot;</i>. Only non existent (<a href='https://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html'>LocalMachine plugin</a>) and<i>&quot;pGina created&quot;</i>user accounts are touched by pGina, if that’s not the case then this particular account wont be altered by pGina. To go further, local non pGina users and Domain users dont run through the plugin chain!</span></p>

<p>The logon process proceeds as follows:</p>

<ol>
<li>The user enters their credentials at the pGina logon user interface. Note that this UI may be one of several options (called credential providers) presented to the user. For example, the user might be presented with several tiles, many of which are local accounts with only one being the pGina UI.</li>

<li>The pGina credential provider (or GINA) passes the credentials to the pGina service. If the user is currently logging off a relogin is denied. If the user is not a pGina user than he is processed by WinAPI authentication procedures, and if a user was already authenticated he will be processed by the WinAPI as well. If nothing from above apply, than the service sends those credentials through the <a href="#plugins">plugin pipeline</a> described below. <strong>This stage potentially fails if you modified the username by using a plugin like <a href="https://mutonufoai.github.io/pgina/documentation/plugins/username_mod.html">Username Modification</a>!</strong></li>

<li>After the credentials have been <a href="#plugins">processed by the plugins</a>, the pGina service sends a result (success/failure) along with a set of credentials (username/ password) back to the pGina CP. Note that these credentials may not be the same as those that were provided by the user. They may have been altered at some stage by one or more plugins.</li>

<li>If the result returned from step three is success, the pGina credential provider passes the (possibly altered) credentials to Windows indicating a successful logon attempt. Note that pGina does not actually log the user on to the machine. It is the Windows OS itself that does that. This means that if a local account does not exist that matches the credentials, the logon will fail, even if the pGina plugins have registered success. Therefore, it is often the case that one of the plugins will be responsible for creating a local (often temporary) account. The plugin called “Local Machine” takes care of this in the Gateway stage. For details, see the <a href="https://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">documentation for the Local Machine plugin</a>.</li>
</ol>

<p>As indicated above, it is important to note that pGina does not actually log the user on to the computer. The Windows OS is still ultimately responsible for logging the user on to the machine and possibly creating a profile for the user. pGina’s job is to authenticate and authorize the user, and perform any other pre-logon actions that may be needed. This means that in order for a logon to be successful, a local account must exist that matches the credentails returned by the pGina CP (Credential Provider). In a typical case, pGina would be configured to create the local account prior to logon, and possibly delete that account after logoff (see the <a href="https://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine plugin</a>).</p>

<p>To explain the logon in a different way </p>

<ul>
<li>If a System is NOT member of a Domain
<ul>
<li>a user will be authenticated against the local system
<ul>
<li><b>exists</b> a user with that name on the system <b>incl. the comment &quot;pGina created&quot;</b> than he will be <b>processed by pGina</b></li>

<li><b>exists</b> a user with that name on the system <b>without the comment &quot;pGina created&quot;</b> than he will be authenticated by the <b>WinAPI</b> and doesn’t go trough the pGina chain.</li>

<li>exists <b>no user</b> with that name on the system than the logon will be <b>processed by pGina</b></li>
</ul>
</li>
</ul>
</li>

<li>If a System IS member of a Domain
<ul>
<li>a user will be authenticated against the Domain</li>

<li>if a user is providing a leading .\ , than he will be authenticated against the local system <a href="https://www.google.com/search?q=windows+force+local+login">google</a>
<ul>
<li>in this case, the same rules apply as if this system where NOT member of a Domain</li>
</ul>
</li>
</ul>
</li>
</ul>

<h3 id="what_username_formats_are_suported">What username formats are suported?</h3>

<h4 id="user_principal_name">User Principal Name</h4>

<p>User principal name (UPN) format is used to specify an Internet-style name, such as UserName@Example.Microsoft.com. The following table summarizes the parts of a UPN.</p>
<table border='1'><tr><td>Part</td><td>Example</td></tr><tr><td><p>User account name. Also known as the logon name.</p></td><td><p><em>UserName</em></p></td></tr><tr><td><p>Separator. A character literal, the at sign (@).</p></td><td><p>@</p></td></tr><tr><td><p>UPN suffix. Also known as the domain name.</p></td><td><p><em>Example.Microsoft</em><strong>.com</strong></p></td></tr></table>
<h4 id="downlevel_logon_name">Down-Level Logon Name</h4>

<p>The down-level logon name format is used to specify a domain and a user account in that domain, for example, DOMAIN\UserName. The following table summarizes the parts of a down-level logon name.</p>
<table border='1'><tr><th>Part</th><th scope='col'>Example</th></tr><tr><td><p>NetBIOS domain name.</p></td><td><p><em>DOMAIN</em></p></td></tr><tr><td><p>Separator. A character literal, the backslash (\).</p></td><td><p>&nbsp;\</p></td></tr><tr><td><p>User account name. Also known as the logon name.</p></td><td><p><em>UserName</em></p></td></tr></table>
<h3 id="the_pgina_architecture">The pGina Architecture</h3>

<p>pGina consists of two main components: the Credential Provider (or GINA), and the pGina service (which manages the plugins).</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_components.png" alt="pGina components" /></p>

<p>The CP augments or replaces the default Windows authentication user interface. It plugs-in to the Windows system and can configure the UI that is displayed at login time (or during unlock, UAC control, etc.). The pGina CP, however, does very little on its own. It simply receives the user’s credentials and passes them along to the pGina service via a named pipe, and then waits for a response from the service. User authentication/authorization is instead managed by the plugins that run within the pGina service.</p>

<p>The pGina service is a standard Windows service that is started at boot time, and runs with SYSTEM priviledges. Note that upon initial boot, it may take some time for pGina service to start, and the CP will (of course) be unable to communicate with the service until it is started.</p>

<h3 id="configuration">Configuration</h3>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_configuration_global.png" alt="pGina stages" /></p>

<ul>
<li><strong>Tile Image</strong> - You can set your own Image here. 200x200 BMP</li>

<li><strong>MOTD</strong> - A short message to display on the login screen. No new lines are displayed!</li>

<li><strong>pGina Service</strong> - The status of the service</li>

<li><strong>Credential Provider</strong> - Enable, disable, register or unregister pGina credential provider</li>

<li><strong>NTP Servers</strong> - You can set NTP Servers here, line by line</li>

<li><strong>Unlock</strong> - If you modify the username using a plugin, you can force here to use the real username during an unlock
<ul>
<li>This will only apply in the unlock screen!</li>
</ul>
</li>

<li><strong>Logon</strong>
<ul>
<li>Display last user name in logon screen - If enabled the last successfully logged in username will be displayed by pGina</li>

<li>Prefer local Authentication - First read <a href="#how_pgina_works">How pGina Works</a>. It’s only usefull in a Domain environment! If enabled the logon routine is reversed.
<ul>
<li>A user can logon locally without providing a leading .\ but if you want to logon with an Domain user account you need to provide the domain like : domain\user</li>
</ul>
</li>
</ul>
</li>

<li><strong>Email Notifications</strong> - If something goes wrong you can enable email notifications here
<ul>
<li>smtp Server - space seperated list of smtp servers smtp.domain.local:25</li>

<li>email Addr: - space seperated list of email recipients</li>

<li>Username: - Username for authentication against an smtp server</li>

<li>Password: - Password for authentication against an smtp server</li>

<li>Prefer Login credentials - If enabled login credentials from the logon/logoff user are used to authenticate against the smtp. As a fallback option Username: and Password: where used</li>

<li>SSL - If disabled the smtp connection is unencrypted. Unencrypted transfer is a fallback if encrytion is not possible.</li>
</ul>
</li>
</ul>

<h4 id="plugins">Plugins</h4>

<p>pGina manages the logon process by delegating the work to a set of zero or more plugins. Plugins have the job of deciding whether or not the user is who she says she is (authentication), whether the user should be granted access (authorization), and taking other login-time actions. The process involves a pipeline consisting of three main stages as illustrated in the following diagram.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_stages.png" alt="pGina stages" /></p>

<p>Each stage involves zero or more plugins, and a given plugin may be involved in multiple stages. After the user provides his/her credentials, pGina passes through the three stages one at a time, in the order shown above. Each stage may succeed or fail depending on the results of the plugins involved. The purpose of each stage is summarized below.</p>

<ul>
<li><strong>Authentication</strong> - Plugins involved in this stage validate that the user is who he/she says she is. This might be done by validating the credentials against some external database or other source.</li>

<li><strong>Authorization</strong> - This stage is intended to determine whether or not the user (who is already authenticated) is allowed to access the resources that are being requested. For example, a user might only be allowed to login if they are a member of certain groups.</li>

<li><strong>Gateway</strong> - This is similar to the Authorization stage in that it may fail, however, the intention is not to authorize users, but to provide post-authorization account management that may fail. For example, the “Local Machine” plugin executes within the gateway stage. It is responsible for creating (if necessary) a local Windows account that matches the credentials of the user that is logging in. If for some reason, this fails, then the user cannot be logged in, and this plugin must stop the login process and provide an appropriate error message. In general, this stage provides a “last chance” for a login to fail (post authenticate/authorize).</li>
</ul>

<p>Plugins can be configured to provide services for zero or more of the above stages. For example, the “LocalMachine” plugin provides services for all three stages. In the authentication stage, it verifies that the user’s credentials match that of some existing local account, and in the authorization state, it verifies that the authenticated user is allowed to log on to the machine.</p>

<p>There can be zero or more plugins involved with each stage. If any stage fails, the login fails. However, stages have different rules regarding when a stage succeeds or fails.</p>
<ul class='greenbg'>
  <li><b>Authentication</b> - At least one of the plugins involved in this stage must register
    success for the process to continue.  If there are zero plugins registered, 
    this stage fails.
  </li>
  <li><b>Authorization</b> -  All plugins involved in this stage must register success for the process to continue.
    If there are no plugins registered, this stage succeeds.
  </li>
  <li><b>Gateway</b> - All plugins involved in this stage must register success for 
    the process to continue.  If there are no plugins registered, this stage
    succeeds.  However, the "Local Machine" plugin will almost always be registered
    in this stage.
  </li>
</ul>
<p>Plugins can provide services to multiple stages, and these services can be selectively turned on or off. For example, consider plugin Foo that provides Authentication and Authorization. pGina can be confiured such that Foo only provides Authentication, only Authorization, both, or neither. Configuration is described later in this document.</p>

<p>Plugins can also be ordered within each stage. For example, suppose plugins Foo and Bar are providing services to the user session stage. We can configure Foo to be invoked before Bar, or Bar before Foo.</p>

<h4 id="user_information">User Information</h4>

<p>During the execution of the above pipeline, pGina maintains some information about the user. This includes user-name, password, group membership and other information. This information can be altered by plugins during the pipeline, and/or used by plugins to modify the state of the machine. For example, plugins may add or remove groups, alter the username or password, or a plugin might attempt to create a local account using this information. This means that the order that the plugins execute within each stage of the pipeline is important (see below), and different orders may produce different results. One must be careful to configure your plugins in the order that makes sense for your setup. The final values of username/password/domain are passed along to Windows to complete the logon process.</p>

<p>In a typical setup one wants to make sure that a local account exists or is created at the end of the pipeline. To do so, one should configure the LocalMachine plugin so that it executes last in the Gateway stage. It is the Gateway stage of the <a href="https://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine</a> plugin that creates (if necessary) local accounts. If the <a href="https://mutonufoai.github.io/pgina/documentation/plugins/local_machine.html">LocalMachine</a> plugin executes earlier, it may miss important information for the local account (such as group membership).</p>

<h3 id="event_notifications">Event Notifications</h3>

<p>Plugins may also register to recieve event notifications from a WindowProc function. These events include: logon, logoff, lock, unlock, console connect, console disconnect, and a few others (see <a href="https://msdn.microsoft.com/en-us/library/aa383828.aspx">msdn</a> for a full list). A plugin that desires to recieve these notifications will be listed as a “Notification” plugin in the configuration interface. The plugin will not recieve events unless it is enabled (see the section on configuration below). Its a good idea to keep Notifications enabled.</p>

<h3 id="change_password">Change Password</h3>

<p>Plugins can register to recieve change password notifications from the Credential Provider, by using CTRL+ALT+DEL or CTRL+ALT+END. <br /><strong>Pgina will not recieve a change password event from the control panel or managment console!</strong> A plugin that desires to recieve these notifications will be listed as a “Change Password” plugin in the configuration interface. The plugin will not recieve events unless it is enabled (see the section on configuration below).</p>

<h2 id="selecting_and_configuring_plugins">Selecting and Configuring Plugins</h2>

<p>In the pGina configuration interface, plugins can be enabled/disabled under the “Plugin Selection” tab. If a plugin provides services for a given stage, a checkbox will appear in the appropriate column. You can enable/disable a plugin for a given stage by using the checkbox.</p>

<p>To configure a plugin, double click on it or select it and click on “Configure..”. The plugin’s configuration dialog will appear. The options are plugin specific, and you should refer to the documentation for each plugin for details about configuration of an individual plugin.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_configuration_plugins.png" alt="pGina stages" /></p>

<h2 id="ordering_plugins">Ordering Plugins</h2>

<p>Under the “Plugin Order” tab, you can determine the order that each plugin is invoked. There is a list for each pGina stage, and you can re-order the plugins within each list.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_configuration_pluginorder.png" alt="pGina stages" /></p>

<h2 id="credential_provider_filter">Credential Provider Filter</h2>

<p>Credential Providers can be filtered for the Logon, Unlock, Change Password and Cred UI screens. Installed Providers are listed under <i>Credential Provider</i>. If you want pGina to be the only Credential Provider available on the logon screen than you need to enable the <i>Logon</i> checkbox for the <i>PasswordProvider</i>.</p>

<p><img src="https://mutonufoai.github.io/pgina/images/documentation/pgina_configuration_providerfilter.png" alt="pGina stages" /></p>

<h2 id="logging">Logging</h2>

<p>pGina logs information to the following files, found in the main pGina installation directory (<code>%ProgramFiles%\pGina.fork\log</code>).</p>

<ul>
<li>
<p><code>pGina.Configuration_log.txt</code></p>

<p>This contains log messages from the pGina configuration application.</p>
</li>

<li>
<p><code>pGina.Service.ServiceHost_log.txt</code></p>

<p>This file contains log messages from the pGina service.</p>
</li>

<li>
<p><code>pGina.InstallUtil_log.txt</code></p>

<p>This contains log messages from the registration utility that is used during installation/uninstallation to enable/disable the CP and pGina service.</p>
</li>
</ul>

<p>Logging support in pGina is supported by <a href="http://logging.apache.org/log4net/">Apache log4net</a>, and is configured within the log4net configuration file, which is (by default) located here:</p>

<p><code>%ProgramFiles%\pGina.fork\log4net.config</code>.</p>

<p>If you would like to log to a different file, simply edit this file. For details about log4net configuration, see the <a href="http://logging.apache.org/log4net/release/manual/introduction.html">Apache log4net documentation</a>.</p>

<h2 id="remember">Remember</h2>

<ul>
<li>local non pGina users and AD users dont run through the plugin chain</li>

<li>pGina users are marked with the user comment of <i>&quot;pGina created&quot;</i></li>

<li>make sure that plugins are in the correct order</li>

<li>be careful if you disable credential providers</li>

<li>use <i>%ProgramFiles%\pGina.fork\log\pGina.Service.ServiceHost_log.txt</i> to trace failures</li>
</ul>

    
		
		<!-- Secondary content: Stuff that goes in the secondary content column (by default, the narrower right column) -->



	</div>

	<div id="footer">
			<div class="left">&copy; 2017 pgina.org</div>
			<div class="right">Original design by 
			<a href="http://www.nodethirtythree.com/">NodeThirtyThree Design</a></div>
	</div>
	
</div>

</body>
</html>

